language: cpp

# let linux be Ubuntu 14.04 Trusty
sudo: required
dist: trusty

os:
    - linux
    - osx

compiler:
    - clang
    - gcc

before_install:
    - echo "$TRAVIS_OS_NAME"
    - if [[ "$TRAVIS_OS_NAME" = "linux" ]];then wget http://apertium.projectjj.com/apt/install-nightly.sh -O - | sudo bash; fi
    - if [[ "$TRAVIS_OS_NAME" = "linux" ]];then sudo apt-get install -y autopoint dh-autoreconf libpython3-all-dev libreadline-dev libreadline6-dev python3-all python3-all-dev swig swig2.0; fi
    - if [[ "$TRAVIS_OS_NAME" = "osx" ]];then wget http://apertium.projectjj.com/osx/install-nightly.sh -O - | sudo bash; fi
    - if [[ "$TRAVIS_OS_NAME" = "osx" ]];then sudo brew update; fi
    - if [[ "$TRAVIS_OS_NAME" = "osx" ]];then sudo brew install bison flex; fi
    - if [[ "$TRAVIS_OS_NAME" = "osx" ]];then export "PATH=/usr/local/opt/bison/bin:$PATH"; fi

# TODO: "apt-get build-dep hfst" fails with "Unable to find a source package for hfst";
# is there a source package in the nightly repo?

script:
    - ./autogen.sh
    - ./configure --enable-xfst --enable-proc --without-foma --enable-lexc --enable-all-tools
    - if [[ $CXX = g++ ]]; then make -j2; else make -j; fi
    - make check

# g++ with -j runs out of memory on travis, thus -j2
